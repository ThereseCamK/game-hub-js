<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="./css/style.css">
    <title>Game Hub | Products</title>
</head>
<body>

  
        <section>
            <h2>Products</h2>
            <div class="filters">
                <form class="filters"> 
                    <input type="text" id="searchInput" placeholder="Search for a game"> 
                    <select id="sortSelect">
                        <option value="default">Filter by genre</option>
                        <option value="sports">Sports</option>
                        <option value="adventure">Adventure</option>
                        <option value="action">Action</option>
                        <option value="horror">Horror</option>
                    </select>
                </form>
            </div>
            
            <div id="products-container"></div>
        </section>
 
    
  <script src="script.js"></script>
</body>
</html>


export const meta = {
    title: "Game Hub | Products",
    description: "Explore all of our games add to cart or click on one single product to get more information",
};

export function render(){
    return `
        <section> 
            <h2>Products</h2>
            <div id="products" class="product-grid">Loading Products...</div>
        </section>
    `;
}

export async function init(controller) {
  document.title = meta.title;
  document
    .querySelector('meta[name="description"]')
    ?.setAttribute("content", meta.description);

  const app = document.getElementById("app");
  app.innerHTML = render();

  const allProducts = await controller.getProducts();
  let filteredProducts = [...allProducts];

  displayProducts(filteredProducts);

  setupFilters();

  function render() {
    return `
      <section>
        <h2>Produkter</h2>

        <form class="filters">
          <input type="text" id="searchInput" placeholder="Search for a game">
          <select id="sortSelect">
            <option value="default">Filter by genre</option>
            <option value="sports">Sports</option>
            <option value="adventure">Adventure</option>
            <option value="action">Action</option>
            <option value="horror">Horror</option>
          </select>
        </form>

        <div id="products" class="product-grid"></div>
      </section>
    `;
  }

  function displayProducts(products) {
    const container = document.getElementById("products");
    if (!products.length) {
      container.innerHTML = "<p>No products  found </p>";
      return;
    }

    container.innerHTML = products
      .map(
        p => `
          <div class="product-card">
            <img src="${p.image.url}" alt="${p.title}" />
            <h3>${p.title}</h3>
            <p>${p.genre.toUpperCase()}</p>
            <p>${p.price} $</p>
            <a href="#/product/${p.id}" class="details-btn">See details</a>
            <button class="cart-btn" data-id="${p.id}">add to cart</button>
          </div>
        `
      )
      .join("");

    container.querySelectorAll(".cart-btn").forEach(btn => {
      btn.addEventListener("click", e => {
        const id = e.target.dataset.id;
        const product = allProducts.find(p => p.id == id);
        controller.addToCart(product);
        alert(`${product.title} is added to your cart!`);
      });
    });
  }

  function setupFilters() {
    const searchInput = document.querySelector('#searchInput');
    const sortSelect = document.querySelector('#sortSelect');

 
    searchInput.addEventListener('input', function() {
      const searchTerm = searchInput.value.toLowerCase();
      filteredProducts = allProducts.filter(p =>
        p.title.toLowerCase().includes(searchTerm)
      );
      displayProducts(filteredProducts);
    });

    
    sortSelect.addEventListener('change', e => {
      const value = e.target.value;
      if (value === "default") {
        filteredProducts = [...allProducts];
      } else {
        filteredProducts = allProducts.filter(p => p.genre.toLowerCase() === value);
      }
      displayProducts(filteredProducts);
    });
  }
}